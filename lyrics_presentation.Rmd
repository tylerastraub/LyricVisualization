---
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE, warning = FALSE, message = FALSE)
library(tidyverse)
library(rvest)
library(geniusR)
library(Rspotify)
library(stringr)
library(tidytext)
library(wordcloud)

# keys to access spotify API (commented out because makes knit command hang)
#spotifyKeys <- spotifyOAuth("mostpopularsongs", "019bc354fbac43bcb0963d1d600ae611", "5248804d1eeb4a1b9ab6220922db7826")
```

# Patterns In Music by Genre
##### A Data Visualization by Tyler Straub

## Some Preamble
  Everyone has prejudices against certain genres of music. Rap is all about drugs and sex! Metal is damaging to the youth! Pop is repetitive trash! But how true are these prejudices? To find out, I looked at some of the more popular songs today from various genres and sifted through the data to find out what trends appear in the lyrics of music today.

## How the Heck Are We Gonna Do This?
  Spotify compiles semi-frequently updated playlists for music of various genres on their app and allows the public to listen to them, so we are going to use this to our advantage to get our song data. Rspotify is a nice package that makes accessing the Spotify API through R easy to do. To get the actual lyric data, we will scrape data from Genius, a website that not only displays lyrics, but allows users to contribute annotations explaining the meaning behind certain lyrics. The package geniusR also acts as a middleman for the Genius API, making our life a little easier.
  
## Let's Get A List of Songs
There is no particular reason why, but the seven genres we'll be looking at are Rap, Pop, RNB, Country, Classic Rock, Metal, and Rock. The inclusion of classic rock is a little redundant with rock, but since it's such a different era, it is interesting to look at nonetheless. Here are the corresponding spotify playlists with each of these genres:

- Rap: Rap Caviar
- Pop: Today's top hits
- RnB: Are & Be
- Country: Hot Country
- Classic Rock: Rock Classics
- Metal: Metal Essentials
- Rock: Rock This

There are some important things to note about these playlists. For starters, "Today's Top Hits" will have some overlap since it's not specifically pop, and there may especially be overlap with Rap Caviar. However, with rap being the most popular genre in 2018, it makes sense that a lot of the most popular songs may have a rap feature in the song.

## Some Code

Here is the only place where we use the Rspotify package. We will use the "getPlaylistSongs" function, which uses the Spotify URI from each playlist to grab some song info.

NOTE: The following code (and a lot of the code in this project) is horribly redundant, inefficient, and quite frankly disgusting. Proceed at your own risk.

```{r}
# this should really be in only one data frame to make life easier
topRap <- getPlaylistSongs("Spotify", "37i9dQZF1DX0XUsuxWHRQd", token = spotifyKeys)
topPop <- getPlaylistSongs("Spotify", "37i9dQZF1DXcBWIGoYBM5M", token = spotifyKeys)
topRnB <- getPlaylistSongs("Spotify", "37i9dQZF1DX4SBhb3fqCJd", token = spotifyKeys)
topCountry <- getPlaylistSongs("Spotify", "37i9dQZF1DX1lVhptIYRda", token = spotifyKeys)
topClassicRock <- getPlaylistSongs("Spotify", "37i9dQZF1DWXRqgorJj26U", token = spotifyKeys)
topMetal <- getPlaylistSongs("Spotify", "37i9dQZF1DWWOaP4H0w5b0", token = spotifyKeys)
topRock <- getPlaylistSongs("Spotify", "37i9dQZF1DXcF6B6QPhFDv", token = spotifyKeys)

# clean up data so that it will be fed into genius
# remove anything in parentheses to get rid of (feat. ...)
topRap$tracks <- str_replace(topRap$tracks, " \\(.*\\)", "")
topPop$tracks <- str_replace(topPop$tracks, " \\(.*\\)", "")
topRnB$tracks <- str_replace(topRnB$tracks, " \\(.*\\)", "")
topCountry$tracks <- str_replace(topCountry$tracks, " \\(.*\\)", "")
topClassicRock$tracks <- str_replace(topClassicRock$tracks, " \\(.*\\)", "")
topMetal$tracks <- str_replace(topMetal$tracks, " \\(.*\\)", "")
topRock$tracks <- str_replace(topRock$tracks, " \\(.*\\)", "")
```

